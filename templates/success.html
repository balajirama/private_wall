{% extends "master.html" %}

{% block title %}
{% endblock %}

{% block content %}
<div class="container">
    {% with errors = get_flashed_messages(category_filter=['error']) %}
    {% for message in errors %}
    <div class="alert alert-danger" role="alert">
        {{ message }}
    </div>
    {% endfor %}
    {% endwith %}
    {% with successes = get_flashed_messages(category_filter=['success']) %}
    {% for message in successes %}
    <div class="alert alert-success" role="alert">
        {{ message }}
    </div>
    {% endfor %}
    {% endwith %}

    <div class="container my-4">
        <h1 class="display-4">Welcome, {{session['firstname']}}!</h1>
        <hr class="my-4">
        <div class="row">
            <div class="col col-lg-3 col-sm-5 col-xs-5">
                <div class="dropdown">
                    <button class="btn btn-primary btn-lg btn-block dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Profile
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <a class="dropdown-item" href="/viewprofile">View Profile</a>
                        <a class="dropdown-item" href="/editprofile">Edit Profile</a>
                        <a class="dropdown-item" href="/changepasswd">Change password</a>
                        <!-- confirmdelete is a modal in confirmdelete.html -->
                        <a class="dropdown-item" data-toggle="modal" data-target="#confirmdelete">Delete Profile</a>
                    </div>
                </div>
            </div>
            <div class="col col-lg-6 col-sm-2 col-xs-2"></div>
            <div class="col col-lg-3 col-sm-5 col-xs-5">
                <a class="btn btn-danger btn-lg btn-block" href="/logout" role="button">Logout</a>
            </div>
        </div>
    </div>

    <hr class="my-4">

    <div class="row">
        <div class="col col-lg-6 col-md-6 col-sm-12 col-xs-12">
            <!-- This is where the receieved messages show up -->
            {% for msg in rec_msgs %}
            <form class="my-1" action="/delmsg/{{msg['message_id']}}">
                <div class="alert alert-primary" role="alert">
                    <p class="my-0"><b>{{msg['firstname']}}:</b></p>
                    {{msg['content']}}
                    <button class="close" type="submit">
                        <img src="{{ url_for('static', filename='img/delmsg.png') }}" alt="close" width="30px">
                    </button>
                </div>
            </form>
            {% else %}
            <div class="jumbotron jumbotron-fluid text-center">
                <div class="container">
                    <img src="{{ url_for('static', filename='img/nothing.png') }}", alt="no message", width="200px">
                    <p class="lead">You have no messages in your feed.</p>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="col col-lg-6 col-md-6 col-sm-12 col-xs-12">
            <!-- This is where you type messages to others -->
            {% for other in other_users %}
            <form action="/sendmsg" method="POST" class="my-4">
                <div class="form-group">
                    <label>{{other['firstname']}}</label><input type="hidden" width="0px" name="recipient_id" value="{{other['id']}}">
                    <div class="row">
                        <div class="col col-lg-11 col-md-11 col-sm-11 col-xs-11">
                            <textarea class="form-control" name="content" rows="3"></textarea>
                        </div>
                    <div class="col col-lg-1 col-md-1 col-sm-1 col-xs-1">
                        <button class="btn btn-primary" type="submit">Send</button>
                    </div>
                    </div>
                </div>
            </form>
            {% else %}
            <div class="jumbotron jumbotron-fluid text-center">
                <div class="container">
                    <img src="{{ url_for('static', filename='img/alone.gif') }}", alt="alone", width="200px">
                    <p class="lead">There are no other users now. Try in a few hours.</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    {% include "confirmdelete.html" %}

</div>
{% endblock %}


